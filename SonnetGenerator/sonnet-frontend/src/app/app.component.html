<div class="container">
    <div class="card">
      <div class="card-body">
        <div class="text-center">
          <div class="header-icon">📝</div>
          <h1 class="card-title mb-4">Sonnet Generator</h1>
          <p class="text-muted mb-4">Enter a topic and let AI create a beautiful 4-line sonnet for you</p>
        </div>

        <form (ngSubmit)="generateSonnet()" #sonnetForm="ngForm">
          <div class="mb-4">
            <label for="topic" class="form-label">Topic</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="topic"
              [(ngModel)]="topic"
              name="topic"
              placeholder="e.g., autumn leaves, ocean waves, morning coffee..."
              [disabled]="loading"
              required
              #topicInput="ngModel">
            <small class="form-text text-muted">Enter any topic you'd like a sonnet about</small>
            <div *ngIf="topicInput.invalid && topicInput.touched" class="text-danger mt-1">
              Topic is required
            </div>
          </div>

          <div class="d-grid gap-2 mb-4">
            <button
              type="submit"
              class="btn btn-primary btn-lg"
              [disabled]="loading || !topic.trim()">
              <span *ngIf="!loading">Generate Sonnet ✨</span>
              <span *ngIf="loading" class="d-flex align-items-center justify-content-center">
                Generating...
                <div class="loading-spinner ms-2"></div>
              </span>
            </button>
          </div>
        </form>

        <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
          {{ error }}
          <button type="button" class="btn-close" (click)="error = ''" aria-label="Close"></button>
        </div>

        <div *ngIf="sonnet" class="mb-3 sonnet-container">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label mb-0">Your Sonnet</label>
            <div class="voice-selector">
              <select
                class="form-select form-select-sm"
                [(ngModel)]="selectedVoice"
                (change)="onVoiceChange()"
                style="width: auto;">
                <option value="en-US-AriaNeural">Aria (Female)</option>
                <option value="en-US-GuyNeural">Guy (Male)</option>
                <option value="en-US-JennyNeural">Jenny (Female)</option>
                <option value="en-GB-SoniaNeural">Sonia (British)</option>
              </select>
            </div>
          </div>

          <textarea
            class="form-control sonnet-textarea"
            rows="5"
            readonly
            [value]="sonnet">
  </textarea>

          <div class="mt-3 text-center">
            <!-- 🔊 SPEECH BUTTONS HERE 🔊 -->
            <button
              class="btn btn-success btn-sm me-2"
              (click)="speakSonnet()"
              [disabled]="isSpeaking">
              <span *ngIf="!isSpeaking">🔊 Listen</span>
              <span *ngIf="isSpeaking">
        🔊 Speaking...
        <div class="speaking-indicator"></div>
      </span>
            </button>

            <button
              *ngIf="isSpeaking"
              class="btn btn-warning btn-sm me-2"
              (click)="stopSpeaking()">
              ⏹️ Stop
            </button>
            <!-- END SPEECH BUTTONS -->

            <button
              class="btn btn-outline-secondary btn-sm me-2"
              (click)="copySonnet()">
              📋 Copy
            </button>

            <button
              class="btn btn-outline-secondary btn-sm"
              (click)="clearSonnet()">
              🗑️ Clear
            </button>
          </div>
        </div>

        <div *ngIf="copySuccess" class="alert alert-success mt-3 fade show" role="alert">
          Sonnet copied to clipboard!
        </div>
      </div>
    </div>

    <div class="text-center mt-4 text-muted">
      <small>Powered by Azure Functions & Azure OpenAI</small>
    </div>
  </div>
